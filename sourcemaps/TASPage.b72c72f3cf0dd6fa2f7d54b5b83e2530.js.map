{"version":3,"file":"js/TASPage.1699347564663.dc6482db7a02183cf0fc.js","mappings":"0JAAIA,EAAsC,WAStC,OARAA,EAAWC,OAAOC,QAAU,SAASC,GACjC,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAII,KADTL,EAAIG,UAAUF,GACOJ,OAAOS,UAAUC,eAAeC,KAAKR,EAAGK,KACzDN,EAAEM,GAAKL,EAAEK,IAEjB,OAAON,CACX,EACOH,EAASa,MAAMC,KAAMP,UAChC,EAwBA,QARkB,SAAUQ,GACxB,IAAIC,EAAWD,EAAGC,SAAUC,EAAYF,EAAGE,UAAWC,EAhBpB,SAAUd,EAAGe,GAC/C,IAAIhB,EAAI,CAAC,EACT,IAAK,IAAIM,KAAKL,EAAOH,OAAOS,UAAUC,eAAeC,KAAKR,EAAGK,IAAMU,EAAEC,QAAQX,GAAK,IAC9EN,EAAEM,GAAKL,EAAEK,IACb,GAAS,MAALL,GAAqD,mBAAjCH,OAAOoB,sBACtB,KAAIhB,EAAI,EAAb,IAAgBI,EAAIR,OAAOoB,sBAAsBjB,GAAIC,EAAII,EAAED,OAAQH,IAC3Dc,EAAEC,QAAQX,EAAEJ,IAAM,GAAKJ,OAAOS,UAAUY,qBAAqBV,KAAKR,EAAGK,EAAEJ,MACvEF,EAAEM,EAAEJ,IAAMD,EAAEK,EAAEJ,IAF4B,CAItD,OAAOF,CACX,CAMkEoB,CAAOR,EAAI,CAAC,WAAY,cAItF,OAHA,IAAAS,YAAU,WACNC,QAAQC,MAAM,4HAClB,GAAG,KACK,SAAK,UAAW1B,EAAS,CAAC,EAAGkB,EAAO,CAAED,UAAW,GAAGU,OAAO,IAAWV,EAAW,qDAAuD,CAAED,SAAUA,IAChK,C,8JCzBA,MAAMY,GAA0B,IAAAC,OAC9B,IAAM,gCAUFC,EAAqB,KACzB,MAAM,UAAEC,IAAc,EAAAC,EAAA,MAChB,SAAEC,EAAQ,SAAEC,EAAQ,KAAEC,GChBN,MACtB,MAAOA,EAAMC,IAAW,IAAAC,UAAS,GAGjC,MAAO,CAAEF,OAAMF,SAFE,IAAMG,GAAShC,GAAMA,EAAI,IAEjB8B,SADR,IAAME,GAAShC,GAAMA,EAAI,IACP,EDYEkC,IAC/B,yBAAEC,EAAwB,wBAAEC,GE+CC,MACnC,MAAM,YAAEC,GAtDH,WACL,MAAOC,EAAaC,GAAkB,kBACpCC,IAEKH,EAAaI,GAAkB,kBAEpCD,IACI,KAAEE,IAAS,EAAAd,EAAA,KA4BjB,OAzBA,eAAgB,MACd,UACKc,EAAKC,WAAWC,MAAM7C,GAAMwC,EAAexC,IAAG,GAElD,IAEH,eAAgB,UACa,IAAhBuC,EAqBf,SACEA,G,sDAEA,MAAMO,QAAiBC,MACrB,8DACA,CACEC,OAAQ,OACRC,QAAS,CACPC,cAAe,UAAUX,OAI/B,aAAcO,EAASK,MACzB,G,CA7BIC,CAAiBb,GAAaM,MAAMQ,ICZ/B,UDasBA,GAOzB/B,QAAQgC,IAAI,gCACZZ,EAAeW,IAPb/B,QAAQC,MACN,wDACA8B,EAKa,IAbjB/B,QAAQgC,IAAI,yBAcZ,GACD,CAACf,IAEG,CAAED,cACX,CAkB0BiB,IAClB,UAAEC,EAAS,KAAEb,IAAS,EAAAd,EAAA,KACtB4B,GAAW,WACVpB,EAAyBqB,GAC9B,cAAe,GAEXC,EAAqB,iBAAkB,KAAY,iDAEvD,QAA2B,IAAhBrB,EAgBT,OAfAhB,QAAQC,MACN,kEAEFkC,GACE,QAAgB,CACdG,QAAS,SACTC,MAAO,qCACPC,aACE,qIAWR,MAAMC,QAAapB,EAAKqB,UACxB,QAAoB,IAATD,EAST,OARAzC,QAAQC,MAAM,iEACdkC,GACE,QAAgB,CACdG,QAAS,SACTC,MAAO,iCACPC,aAAa,8DAMnB,MAAMG,EAAU,+BACX3B,GAAW,CACd4B,MAAOH,EAAKI,SAASC,OACrBC,OAAQN,EAAKI,SAASG,iBAGlBC,EAAgB,IAAIC,KAAK,CAACC,KAAKC,UAAUT,IAAc,CAC3DU,KAAM,mCAIFC,EAAMC,IAAIC,gBAAgBP,GAG1BQ,EAAIC,SAASC,cAAc,KACjCF,EAAEG,KAAON,EACTG,EAAEI,SAAW,mBAGbH,SAASI,KAAKC,YAAYN,GAG1BA,EAAEO,QAGFN,SAASI,KAAKG,YAAYR,GAG1BF,IAAIW,gBAAgBZ,GAEpBlB,GAA2B,EAC7B,KAAG,CAACpB,EAAaK,EAAMc,EAAUC,IAMjC,MAAO,CACLrB,0BACAD,yBAN+B,iBAAkB,KAAY,iDAC7DoB,EAAUiC,MAAM,IAAOC,kCACvB/B,GACF,KAAG,CAACH,EAAWG,IAId,EFhICgC,IACI,yBAAEC,GCZH,WACL,MAAM,UAAEpC,IAAc,EAAA3B,EAAA,KAStB,MAAO,CAAE+D,0BAPwB,IAAAC,cAAY,KAC3CrC,EAAUiC,MAAM,IAAOK,2BACvBC,OAAOC,KACL,2HACD,GACA,CAACxC,IAGN,CDCuCyC,GAOrC,OALA,IAAA5E,YAAU,KACRO,EAAU,cAAc,GAEvB,KAGD,UAAC,aAAc,YACb,+BACEsE,MAAO,CACLC,YAAa,SACbC,WAAY,OACZC,cAAe,SAChB,YAED,SAACC,EAAA,EAAe,CAACzC,MAAM,qBACvB,uGAIF,SAAC0C,EAAA,GAAI,WACH,SAAC,EAAAC,MAAK,eAACC,WAAS,cACd,SAAC,EAAAC,UAAS,WACR,SAAC,EAAAC,SAAQ,eAACC,UAAU,SAAC,EAAAC,QAAO,KAAG,WAC7B,SAACpF,EAAuB,CACtBK,SAAUA,EACVgF,aAAc/E,EACdgF,YAAa/E,EACbgF,iBAAkB5E,EAClBC,wBAAyBA,EACzB4E,qBAAsBrB,gBAOnC,EAGHjE,EAAmBuF,YAAc,0BI9DjC,S,iCCDA,MAeA,EALyB,OAAH,wBAVc,CAClCxB,iCAAkC,sCAClCI,0BAA2B,iCAIA,CAC3BqB,sBAAuB,yB","sources":["webpack:///./node_modules/@redhat-cloud-services/frontend-components/esm/Main/Main.js","webpack:///./src/Routes/ArtifactSignerPage/ArtifactSigner.tsx","webpack:///./src/hooks/misc.ts","webpack:///./src/hooks/pull-secret.tsx","webpack:///./src/types/index.ts","webpack:///./src/Routes/ArtifactSignerPage/index.ts","webpack:///./src/common/analytics.ts"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect } from 'react';\nimport classNames from 'classnames';\nimport '../Main/main.css';\nexport var Main = function (_a) {\n    var children = _a.children, className = _a.className, props = __rest(_a, [\"children\", \"className\"]);\n    useEffect(function () {\n        console.error(\"Using deprecated \\\"Main\\\" component. Do not use it. Either remove it from your JSX or replace it by \\\"section\\\" HTML element.\");\n    }, []);\n    return (_jsx(\"section\", __assign({}, props, { className: \"\".concat(classNames(className, 'pf-l-page__main-section pf-c-page__main-section')) }, { children: children })));\n};\nexport var InternalMain = Main;\nexport default Main;\n//# sourceMappingURL=Main.js.map","import React, { Suspense, lazy, useEffect } from 'react';\n\nimport { Spinner, Stack, StackItem } from '@patternfly/react-core';\nimport { Main } from '@redhat-cloud-services/frontend-components/Main';\nimport { PageHeaderTitle } from '@redhat-cloud-services/frontend-components/PageHeader';\nimport useChrome from '@redhat-cloud-services/frontend-components/useChrome';\n\nconst ArtifactSignerComponent = lazy(\n  () => import('../../components/ArtifactSigner/artifact-signer')\n);\n\nimport './artifact-signer.scss';\nimport { useDownloadPullSecret, useSteps, useDocumentation } from '../../hooks';\n\n/**\n * https://reactjs.org/docs/components-and-props.html\n * https://medium.com/@thejasonfile/dumb-components-and-smart-components-e7b33a698d43\n */\nconst ArtifactSignerPage = () => {\n  const { appAction } = useChrome();\n  const { nextStep, prevStep, step } = useSteps();\n  const { handleDownloadPullSecret, userHasDownloadedSecret } =\n    useDownloadPullSecret();\n  const { handleDocumentationClick } = useDocumentation();\n\n  useEffect(() => {\n    appAction('secure-sign');\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <React.Fragment>\n      <div\n        style={{\n          paddingLeft: '2.5rem',\n          paddingTop: '1rem',\n          paddingBottom: '1rem',\n        }}\n      >\n        <PageHeaderTitle title=\"Artifact Signer\" />\n        <p>\n          Enables cryptographic signing, verification and provenance of software\n        </p>\n      </div>\n      <Main>\n        <Stack hasGutter>\n          <StackItem>\n            <Suspense fallback={<Spinner />}>\n              <ArtifactSignerComponent\n                nextStep={nextStep}\n                previousStep={prevStep}\n                currentStep={step}\n                onDownloadSecret={handleDownloadPullSecret}\n                userHasDownloadedSecret={userHasDownloadedSecret}\n                onDocumentationClick={handleDocumentationClick}\n              />\n            </Suspense>\n          </StackItem>\n        </Stack>\n      </Main>\n    </React.Fragment>\n  );\n};\n\nArtifactSignerPage.displayName = 'Trusted Artifact Signer';\n\nexport { ArtifactSignerPage };\n","import useChrome from '@redhat-cloud-services/frontend-components/useChrome';\nimport { useState, useCallback } from 'react';\nimport events from '../common/analytics';\n\nexport const useSteps = () => {\n  const [step, setStep] = useState(0);\n  const nextStep = () => setStep((s) => s + 1);\n  const prevStep = () => setStep((s) => s - 1);\n  return { step, nextStep, prevStep };\n};\n\nexport function useDocumentation() {\n  const { analytics } = useChrome();\n\n  const handleDocumentationClick = useCallback(() => {\n    analytics.track(events.TAS_DOCUMENTATION_CLICKED);\n    window.open(\n      'https://access.redhat.com/documentation/en-us/red_hat_trusted_artifact_signer/2023-q4/html-single/deployment_guide/index'\n    );\n  }, [analytics]);\n\n  return { handleDocumentationClick };\n}\n","import React from 'react';\nimport { useDispatch } from 'react-redux';\nimport useChrome from '@redhat-cloud-services/frontend-components/useChrome';\nimport type {\n  PullSecret,\n  OCMErrorResponse,\n  AccountsAccessToken,\n} from '../types';\nimport { objectIsAccessToken } from '../types';\nimport {\n  addNotification,\n  clearNotifications,\n} from '@redhat-cloud-services/frontend-components-notifications/redux';\nimport events from '../common/analytics';\n\nexport function useAccountsAccessToken() {\n  const [bearerToken, setBearerToken] = React.useState<string | undefined>(\n    undefined\n  );\n  const [accessToken, setAccessToken] = React.useState<\n    AccountsAccessToken | undefined\n  >(undefined);\n  const { auth } = useChrome();\n\n  // only run this on mount\n  React.useEffect(() => {\n    clearNotifications();\n    void auth.getToken().then((t) => setBearerToken(t));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  React.useEffect(() => {\n    if (typeof bearerToken === 'undefined') {\n      console.log('authToken is undefined');\n      return;\n    }\n    // TODO(RobotSail): Replace this with useSWR or react query to automatically handle refetch logic\n    fetchAccessToken(bearerToken).then((r) => {\n      if (!objectIsAccessToken(r)) {\n        console.error(\n          'received error response from createAuthorizationToken',\n          r\n        );\n        return;\n      }\n      console.log('received authorization token');\n      setAccessToken(r);\n    });\n  }, [bearerToken]);\n\n  return { accessToken };\n}\n\nasync function fetchAccessToken(\n  bearerToken: string\n): Promise<AccountsAccessToken | OCMErrorResponse> {\n  const response = await fetch(\n    'https://api.openshift.com/api/accounts_mgmt/v1/access_token',\n    {\n      method: 'POST',\n      headers: {\n        Authorization: `Bearer ${bearerToken}`,\n      },\n    }\n  );\n  return (await response.json()) as AccountsAccessToken | OCMErrorResponse;\n}\n\nexport const useDownloadPullSecret = () => {\n  const { accessToken } = useAccountsAccessToken();\n  const { analytics, auth } = useChrome();\n  const dispatch = useDispatch();\n  const [userHasDownloadedSecret, setUserHasDownloadedSecret] =\n    React.useState(false);\n\n  const downloadPullSecret = React.useCallback(async () => {\n    // pull secret can't be downloaded\n    if (typeof accessToken === 'undefined') {\n      console.error(\n        'could not download pull secret, access token is undefined'\n      );\n      dispatch(\n        addNotification({\n          variant: 'danger',\n          title: 'Could not download the pull secret',\n          description: (\n            <p>\n              User Access Token is empty. Please try refreshing the page and\n              checking the console output for errors.\n            </p>\n          ),\n        })\n      );\n      return;\n    }\n\n    // get user's orgID & userID\n    const user = await auth.getUser();\n    if (typeof user === 'undefined') {\n      console.error('could not download pull secret, user object is undefined');\n      dispatch(\n        addNotification({\n          variant: 'danger',\n          title: 'Could not get user information',\n          description: <p>Could not read the user object.</p>,\n        })\n      );\n      return;\n    }\n\n    const pullSecret: PullSecret = {\n      ...accessToken,\n      orgId: user.identity.org_id,\n      userId: user.identity.account_number,\n    };\n\n    const rawPullSecret = new Blob([JSON.stringify(pullSecret)], {\n      type: 'application/json;charset=utf-8',\n    });\n\n    // Create a URL for the file blob\n    const url = URL.createObjectURL(rawPullSecret);\n\n    // Create a new anchor element to trigger the download\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'pull-secret.json';\n\n    // Append the anchor element to the body\n    document.body.appendChild(a);\n\n    // Trigger the download\n    a.click();\n\n    // Remove the anchor element from the body\n    document.body.removeChild(a);\n\n    // Revoke the URL to free up memory\n    URL.revokeObjectURL(url);\n\n    setUserHasDownloadedSecret(true);\n  }, [accessToken, auth, dispatch, setUserHasDownloadedSecret]);\n\n  const handleDownloadPullSecret = React.useCallback(async () => {\n    analytics.track(events.TAS_PULL_SECRET_DOWNLOAD_CLICKED);\n    downloadPullSecret();\n  }, [analytics, downloadPullSecret]);\n  return {\n    userHasDownloadedSecret,\n    handleDownloadPullSecret,\n  };\n};\n","export type AccountsAccessToken = {\n  auths: {\n    [domain: string]: {\n      auth: string;\n      email?: string;\n    };\n  };\n};\n\nexport type OCMErrorResponse = {\n  kind: string;\n  id: string;\n  href: string;\n  code: string;\n  reason?: string;\n};\n\nexport type PullSecret = {\n  userId?: string;\n  orgId: string;\n} & AccountsAccessToken;\n\nexport function objectIsAccessToken(\n  obj: AccountsAccessToken | OCMErrorResponse\n): obj is AccountsAccessToken {\n  return 'auths' in obj;\n}\n","import { ArtifactSignerPage } from './ArtifactSigner';\n\nexport default ArtifactSignerPage;\n","// all analytics events for trusted artifact signer go here\nconst TrustedArtifactSignerEvents = {\n  TAS_PULL_SECRET_DOWNLOAD_CLICKED: 'tas-ui-clicked-download-pull-secret',\n  TAS_DOCUMENTATION_CLICKED: 'tas-ui-clicked-documentation',\n};\n\n// all analytics events for trusted content go here\nconst TrustedContentEvents = {\n  TC_WAITING_LIST_CLICK: 'tc-learn-more-1-click',\n};\n\nconst ANALYTICS_EVENTS = {\n  ...TrustedArtifactSignerEvents,\n  ...TrustedContentEvents,\n};\n\nexport default ANALYTICS_EVENTS;\n"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","_a","children","className","props","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__rest","useEffect","console","error","concat","ArtifactSignerComponent","lazy","ArtifactSignerPage","appAction","useChrome","nextStep","prevStep","step","setStep","useState","useSteps","handleDownloadPullSecret","userHasDownloadedSecret","accessToken","bearerToken","setBearerToken","undefined","setAccessToken","auth","getToken","then","response","fetch","method","headers","Authorization","json","fetchAccessToken","r","log","useAccountsAccessToken","analytics","dispatch","setUserHasDownloadedSecret","downloadPullSecret","variant","title","description","user","getUser","pullSecret","orgId","identity","org_id","userId","account_number","rawPullSecret","Blob","JSON","stringify","type","url","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","track","TAS_PULL_SECRET_DOWNLOAD_CLICKED","useDownloadPullSecret","handleDocumentationClick","useCallback","TAS_DOCUMENTATION_CLICKED","window","open","useDocumentation","style","paddingLeft","paddingTop","paddingBottom","PageHeaderTitle","Main","Stack","hasGutter","StackItem","Suspense","fallback","Spinner","previousStep","currentStep","onDownloadSecret","onDocumentationClick","displayName","TC_WAITING_LIST_CLICK"],"sourceRoot":""}